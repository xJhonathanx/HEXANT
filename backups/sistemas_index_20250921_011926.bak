import type { World } from "../../tipos";
import type { Cfg } from "../configuracion/predeterminados";

import { SistemaSemilla } from "./SistemaSemilla";
import { SistemaReina } from "./SistemaReina";
import { SistemaIA } from "./SistemaIA";
import { SistemaCria } from "./SistemaCria";
import { SistemaCriaLogistica } from "./SistemaCriaLogistica";
import { SistemaPlanificacion } from "./SistemaPlanificacion";
import { SistemaMetabolismo } from "./SistemaMetabolismo";

export function ejecutarSistemas(w:World, cfg:Cfg){
  (w as any)._tick = ((w as any)._tick ?? 0) + 1;

  // 1) Semilla: garantiza 1 builder + 3 workers
  SistemaSemilla(w, cfg);

  // 2) Reina (postura con costo/banco)
  if (typeof SistemaReina === "function") SistemaReina(w, cfg);

  // 3) Logística de cría (mover huevos al hex objetivo)
  if (typeof SistemaCriaLogistica === "function") SistemaCriaLogistica(w);

  // 4) Desarrollo / eclosión
  if (typeof SistemaCria === "function") SistemaCria(w, cfg);

  // 5) IA (obreras/constructora) + metabolismo
  if (typeof SistemaIA === "function") SistemaIA(w, cfg);
  if (typeof SistemaMetabolismo === "function") SistemaMetabolismo(w, cfg);

  // 6) Planificación de nuevo hex (sólo con 6 huevos listos y constructora viva)
  const m = w.meta;
  if (m && m.broodEggsStaged >= 6 && !m.broodTransferPending && w.ants.some(a=>a.kind==="builder")){
    SistemaPlanificacion(w, cfg);
  }
}

